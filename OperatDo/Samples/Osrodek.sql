-- dokument powiÄ…zany
BEGIN
  select count(*)
  from operdok
  where id_blob = :ID_BLOB and typ<>'W' and typ<>'O'
  INTO :LP;
  SUSPEND;
END

CREATE TABLE FBDOK
(
  UID Integer NOT NULL,
  TRESC Blob sub_type 0,
  MINI Blob sub_type 0,
  DTW Timestamp,
  OSOW Integer,
  DTU Timestamp,
  OSOU Integer
);

CREATE UNIQUE INDEX IFBDOKUID ON FBDOK (UID);
CREATE GENERATOR FBDOKG;

CREATE TABLE OPERATY
(
  UID Integer NOT NULL,
  NRJEDNEWID Char(3) COLLATE PXW_PLK,
  TYP Char(1) COLLATE PXW_PLK,
  CZLON_1 Varchar(10) COLLATE PXW_PLK,
  CZLON_2 Char(4) COLLATE PXW_PLK,
  CZLON_3 Integer,
  CZLON_4 Char(4) COLLATE PXW_PLK,
  CZLON_5 Varchar(10) DEFAULT '' COLLATE PXW_PLK,
  ID_ROBOTY Integer,
  ID_OSOBY Integer,
  D_WYP Date,
  D_PLAN Date,
  ID_ZAM Integer,
  UWAGI Varchar(50) COLLATE PXW_PLK,
  CYFR_ID Varchar(60) COLLATE PXW_PLK,
  TYP_AKT Char(1) COLLATE PXW_PLK,
  D_ZPA Date,
  KAT_AKT Varchar(5) COLLATE PXW_PLK,
  DTP Timestamp,
  OSOP Integer,
  DTW Timestamp,
  OSOW Integer,
  DTU Timestamp,
  OSOU Integer,
  KLASA Char(1) DEFAULT 'O' COLLATE PXW_PLK,
  C1 Char(1) DEFAULT '' COLLATE PXW_PLK,
  C2 Varchar(10) DEFAULT '' COLLATE PXW_PLK,
  C3 Integer DEFAULT 0,
  C4 Integer DEFAULT 0,
  GODLONAZWA Varchar(50) COLLATE PXW_PLK,
  SKALA Varchar(20) COLLATE PXW_PLK,
  UKLAD Integer,
  SKR_DOK Integer,
  SKR_OPIS Integer,
  D_DRUK Date,
  NAKLAD Integer,
  SPOSOB_POZYSK Integer,
  D_PRZYJECIA Date,
  JEZYK Char(3) COLLATE PXW_PLK,
  ID_TWORCY Integer,
  OPIS Varchar(255) COLLATE PXW_PLK,
  POSTAC_MAT Integer,
  DOSTEP Integer,
  ID_PODSTP Integer,
  RODZ_NOSNIKA Integer,
  TYP_MATERIALU Integer,
  NAZWA_MAT Integer,
  DA_DATA Date,
  DA_DPOCZ Date,
  DA_DKON Date,
  DOK_WYL Varchar(255) COLLATE PXW_PLK,
  DD_WYL Date,
  D_WYL Date,
  ID_NAD_ORGAN Varchar(100) COLLATE PXW_PLK
);
CREATE INDEX IOPERATYID_ZAM ON OPERATY (TYP,ID_ZAM);
CREATE UNIQUE INDEX IOPERATYUID ON OPERATY (UID);
CREATE INDEX IOPERATY_CZ12 ON OPERATY (CZLON_1,CZLON_2);
CREATE INDEX IOPERATY_IDOS_DWYP ON OPERATY (TYP,ID_OSOBY,D_WYP);
CREATE INDEX IOPERATY_JE_C12345 ON OPERATY (TYP,NRJEDNEWID,CZLON_1,CZLON_2,CZLON_3,CZLON_4,CZLON_5);
CREATE INDEX IOPERATY_JE_C12435 ON OPERATY (TYP,NRJEDNEWID,CZLON_1,CZLON_2,CZLON_4,CZLON_3,CZLON_5);
CREATE INDEX IOPERATY_JE_CYFRID ON OPERATY (TYP,NRJEDNEWID,CYFR_ID);
CREATE INDEX IOPERATY_K_JE_CZ15 ON OPERATY (TYP,ID_ROBOTY,NRJEDNEWID,CZLON_1,CZLON_2,CZLON_3,CZLON_4,CZLON_5);
CREATE INDEX IOPERATY_NEW_C1234 ON OPERATY (C1,C2,C3,C4,TYP,NRJEDNEWID,CZLON_1,CZLON_2,CZLON_4,CZLON_3,CZLON_5);
CREATE GENERATOR OPERATYG;

CREATE TABLE OPERDOK
(
  UID Integer NOT NULL,
  TYP Char(1) COLLATE PXW_PLK,
  ID_OPE Integer,
  DOKUMENT Varchar(30) COLLATE PXW_PLK,
  ADRES Varchar(8) COLLATE PXW_PLK,
  TYP_DOK Smallint,
  GRUPA Smallint,
  XPPM Integer,
  YPPM Integer,
  KOMPRESJA Smallint,
  ORG_WIELK Integer,
  KAT_AKT Char(1) COLLATE PXW_PLK,
  ID_BLOB Integer,
  DTW Timestamp,
  OSOW Integer,
  DTU Timestamp,
  OSOU Integer,
  NR_DOK Integer,
  NAZ_DOK Integer
);
CREATE INDEX IOPERDOKADRES ON OPERDOK (TYP,ID_OPE,ADRES);
CREATE INDEX IOPERDOKDOKUMENT ON OPERDOK (TYP,ID_OPE,DOKUMENT);
CREATE INDEX IOPERDOKGRUPADOKUMENT ON OPERDOK (TYP,ID_OPE,GRUPA,DOKUMENT);
CREATE INDEX IOPERDOKID_BLOB ON OPERDOK (ID_BLOB,TYP);
CREATE INDEX IOPERDOKNRDOK ON OPERDOK (TYP,ID_OPE,NR_DOK,DOKUMENT);
CREATE UNIQUE INDEX IOPERDOKUID ON OPERDOK (UID);
CREATE GENERATOR OPERDOKG;